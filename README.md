# DOCX to JSON Converter

ä¸€ä¸ªæ™ºèƒ½çš„DOCXæ–‡æ¡£è½¬JSONå·¥å…·ï¼Œä¸“é—¨ç”¨äºæå–å’Œç»„ç»‡æ–‡æ¡£ä¸­çš„å›¾åƒã€æ–‡æœ¬å†…å®¹ï¼Œå¹¶å®ç°é«˜çº§çš„å›¾åƒåˆ†ç»„åŠŸèƒ½ã€‚

## ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½å›¾åƒåˆ†ç»„**ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶è¡Œï¼ˆrowï¼‰å’Œå‚ç›´ç›¸é‚»ï¼ˆcolumnï¼‰çš„å›¾åƒç»„åˆ
- **çœŸå®èµ„æºæå–**ï¼šä»DOCXæ–‡ä»¶ä¸­æå–çœŸå®å›¾åƒå¹¶ç”ŸæˆSHA256å“ˆå¸ŒID
- **å®Œæ•´å†…å®¹æå–**ï¼šæ”¯æŒæ®µè½æ–‡æœ¬å’Œè¡¨æ ¼å†…å®¹çš„å®Œæ•´æå–
- **æ ‡é¢˜ä¸æ¥æºå½’å±**ï¼šæ™ºèƒ½åˆ†é…å›¾åƒæ ‡é¢˜å’Œæ¥æºä¿¡æ¯
- **æ–‡æ¡£é¡ºåºä¿æŒ**ï¼šæŒ‰åŸæ–‡æ¡£é¡ºåºè¾“å‡ºæ‰€æœ‰å†…å®¹å—

### ğŸ§  äºŒé˜¶æ®µåˆ†ç»„ç®—æ³•

#### Phase 1: åŒæ®µè½åˆ†ç»„ (Row Layout)
- åŒä¸€æ®µè½å†…çš„å¤šå¼ å›¾åƒè‡ªåŠ¨ç»„åˆä¸º`layout='row'`
- å…¸å‹åœºæ™¯ï¼šå¹¶æ’å¯¹æ¯”å›¾è¡¨

#### Phase 2: ç›¸é‚»æ®µè½åˆ†ç»„ (Column Layout)  
- è¿ç»­æ®µè½ä¸­çš„å›¾åƒæ ¹æ®é—´éš”å’Œæ–‡æœ¬é‡è¿›è¡Œåˆ†ç»„
- ä»…å½“é—´éš”â‰¤`max_gap_paras`ä¸”æ— å¤§é‡æ–‡æœ¬(>max_title_len chars)æ—¶åˆ†ç»„
- ç‰¹æ®Šè§„åˆ™ï¼šè‹¥ç»„åˆå®½åº¦â‰¤`page_width_ratio` * é¡µé¢å®½åº¦ï¼Œåˆ™ä½¿ç”¨`layout='row'`

#### æ ‡é¢˜ä¸æ¥æºå½’å±
- **æ ‡é¢˜**ï¼šåˆ†é…ç»™ç»„å†…é¦–å›¾ï¼Œæ¥è‡ªé™„è¿‘çš„çŸ­æ–‡æœ¬(â‰¤max_title_len chars)
- **æ¥æº**ï¼šåˆ†é…ç»™ç»„å†…æœ«å›¾ï¼ŒåŒ¹é…"æ¥æº:/Source:"æ¨¡å¼çš„æ–‡æœ¬

## å®‰è£…

### ç¯å¢ƒè¦æ±‚
- Python 3.7+
- python-docx åº“

### å®‰è£…æ­¥éª¤
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd docx2json

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install python-docx
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•
```bash
python to_ncj.py "document.docx"
```

### å®Œæ•´å‚æ•°
```bash
python to_ncj.py "input.docx" [options]
  --out content.json        # è¾“å‡ºJSONæ–‡ä»¶ (é»˜è®¤: content.json)
  --assets-dir assets/media # å›¾åƒèµ„æºç›®å½• (é»˜è®¤: assets/media)
  --max_title_len 45        # æ ‡é¢˜æ£€æµ‹æœ€å¤§å­—ç¬¦æ•° (é»˜è®¤: 45)
  --max_gap_paras 1         # åˆ†ç»„æœ€å¤§æ®µè½é—´éš” (é»˜è®¤: 1) 
  --page_width_ratio 0.95   # è¡Œå¸ƒå±€æ£€æµ‹å®½åº¦æ¯”ä¾‹ (é»˜è®¤: 0.95)
  --debug                   # åœ¨è¾“å‡ºä¸­åŒ…å«åˆ†ç»„æ¨ç†ä¿¡æ¯
```

### ç¤ºä¾‹
```bash
# åŸºæœ¬è½¬æ¢
python to_ncj.py "æŠ¥å‘Š.docx" --out report.json

# å¸¦è°ƒè¯•ä¿¡æ¯çš„è½¬æ¢
python to_ncj.py "åˆ†æ.docx" --debug --assets-dir images/

# è°ƒæ•´åˆ†ç»„å‚æ•°
python to_ncj.py "æ–‡æ¡£.docx" --max_gap_paras 2 --max_title_len 60
```

## è¾“å‡ºæ ¼å¼

### JSONç»“æ„
```json
{
  "doc": {
    "title": "æ–‡æ¡£æ ‡é¢˜",
    "date": "2025-08-18", 
    "locale": "zh-CN",
    "version": "v1",
    "source_file": "original.docx"
  },
  "blocks": [
    {
      "type": "paragraph",
      "text": "æ®µè½æ–‡æœ¬å†…å®¹"
    },
    {
      "type": "figure",
      "image": {"asset_id": "img_76f7bfb095b6"},
      "title": "å›¾è¡¨æ ‡é¢˜",
      "credit": "æ•°æ®æ¥æº",
      "group_id": "grp_0001",
      "group_seq": 1,
      "group_len": 2,
      "layout": "row"
    }
  ],
  "assets": [
    {
      "asset_id": "img_76f7bfb095b6",
      "filename": "assets/img_76f7bfb095b6.png",
      "sha256": "76f7bfb095b6f67f8cc5c56857be9ef285cf4065..."
    }
  ],
  "report": {
    "warnings": [],
    "debug": ["grp_0001: row by same-paragraph(para=4, 2 images)..."]
  }
}
```

### å­—æ®µè¯´æ˜
- **group_id**: å”¯ä¸€åˆ†ç»„æ ‡è¯†ç¬¦
- **group_seq**: åœ¨ç»„å†…çš„åºå·(1å¼€å§‹)  
- **group_len**: ç»„å†…å›¾åƒæ€»æ•°
- **layout**: å¸ƒå±€ç±»å‹(`"row"`å¹¶è¡Œ | `"column"`å‚ç›´)
- **asset_id**: åŸºäºSHA256çš„çœŸå®å›¾åƒID

## æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæ¨¡å—
1. **å›¾åƒæå–** (`extract_figures_from_docx`): ä»æ®µè½å’Œè¡¨æ ¼ä¸­æå–å›¾åƒ
2. **èµ„æºå¤„ç†** (`extract_and_hash_images`): ZIPè§£å‹å’ŒSHA256å“ˆå¸Œè®¡ç®—  
3. **æ™ºèƒ½åˆ†ç»„** (`group_figures`): äºŒé˜¶æ®µåˆ†ç»„ç®—æ³•å®ç°
4. **å±æ€§åˆ†é…** (`assign_titles_and_credits`): æ ‡é¢˜å’Œæ¥æºçš„æ™ºèƒ½å½’å±

### è®¾è®¡ç‰¹ç‚¹
- **åˆ†ç¦»å¼blockè®¾è®¡**ï¼šä¿æŒæ–‡æ¡£çº¿æ€§ç»“æ„ï¼Œä¾¿äºé¡ºåºæ¸²æŸ“
- **å¯é…ç½®å‚æ•°**ï¼šçµæ´»è°ƒæ•´åˆ†ç»„è¡Œä¸ºä»¥é€‚åº”ä¸åŒæ–‡æ¡£ç±»å‹
- **çœŸå®èµ„æºç®¡ç†**ï¼šé¿å…placeholderï¼Œç¡®ä¿èµ„æºå®Œæ•´æ€§
- **è°ƒè¯•å‹å¥½**ï¼šæä¾›è¯¦ç»†çš„åˆ†ç»„æ¨ç†ä¿¡æ¯

## å¼€å‘

### é¡¹ç›®ç»“æ„
```
docx2json/
â”œâ”€â”€ to_ncj.py              # ä¸»è½¬æ¢è„šæœ¬
â”œâ”€â”€ README.md              # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ assets/                # æå–çš„å›¾åƒèµ„æº
â”‚   â”œâ”€â”€ 250818_summer_break/
â”‚   â””â”€â”€ 250804_negative_revisions/
â”œâ”€â”€ *.docx                 # æµ‹è¯•æ–‡æ¡£
â”œâ”€â”€ *.json                 # è½¬æ¢ç»“æœ
â””â”€â”€ venv/                  # è™šæ‹Ÿç¯å¢ƒ
```

### æµ‹è¯•
é¡¹ç›®åŒ…å«ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š
- `250818 - Summer Break.docx`: 14å›¾åƒï¼Œ11åˆ†ç»„ï¼Œ3ä¸ªå¤šå›¾åˆ†ç»„
- `250804 - Negative Revisions.docx`: 25å›¾åƒï¼Œ15åˆ†ç»„ï¼Œ10ä¸ªå¤šå›¾åˆ†ç»„

### æ‰©å±•
ç®—æ³•æ”¯æŒä»¥ä¸‹æ‰©å±•ï¼š
- æ–°çš„å¸ƒå±€ç±»å‹æ£€æµ‹
- è‡ªå®šä¹‰æ ‡é¢˜/æ¥æºåŒ¹é…æ¨¡å¼  
- å¤šè¯­è¨€æ–‡æ¡£æ”¯æŒ
- æ›´å¤æ‚çš„å›¾åƒæ’åˆ—è¯†åˆ«

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæœ‰äº›å›¾åƒæ²¡æœ‰æ ‡é¢˜ï¼Ÿ
A: æ ‡é¢˜åˆ†é…åŸºäºé™„è¿‘æ–‡æœ¬çš„é•¿åº¦å’Œä½ç½®ã€‚æ–‡æ¡£æ ‡é¢˜ä¸ä¼šåˆ†é…ç»™é¦–å›¾ï¼Œç¡®ä¿æ ‡é¢˜å½’å±çš„å‡†ç¡®æ€§ã€‚

### Q: å¦‚ä½•è°ƒæ•´åˆ†ç»„æ•æ„Ÿåº¦ï¼Ÿ
A: ä½¿ç”¨`--max_gap_paras`è°ƒæ•´æ®µè½é—´éš”å®¹å¿åº¦ï¼Œä½¿ç”¨`--max_title_len`è°ƒæ•´æ ‡é¢˜æ£€æµ‹é•¿åº¦ã€‚

### Q: è¾“å‡ºçš„å›¾åƒæ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ
A: å›¾åƒä¿å­˜åœ¨`--assets-dir`æŒ‡å®šçš„ç›®å½•ä¸­ï¼Œæ–‡ä»¶åä½¿ç”¨SHA256å“ˆå¸Œç¡®ä¿å”¯ä¸€æ€§ã€‚

## License

MIT License - è¯¦è§ LICENSE æ–‡ä»¶

## è´¡çŒ®

æ¬¢è¿æäº¤ Issues å’Œ Pull Requestsï¼

---

*è¯¥é¡¹ç›®ä¸“ä¸ºéœ€è¦ç²¾ç¡®å›¾åƒåˆ†ç»„å’Œå†…å®¹æå–çš„æ–‡æ¡£å¤„ç†åœºæ™¯è®¾è®¡*